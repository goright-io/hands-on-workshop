import Layout from "../../templates/layout"

export default Layout
export const meta = { title: "Build and Deployment" }



## Building the library

When you feel your library is ready for production, you can build it:

```
yarn build:design-system
```

A minified production build of the library will be created in /dist folder. It is imported in your product's package.json folder.

## Releasing the library

1. First you need to bump the version of the library, you can use the following command:

```
yarn version:design-system
```

You will be prompted to type a version. Alternatively, you can run the command above with one of the flags: `--patch`, `--minor`, `--major`.

1. Next, you will need to update the version of your library in product workspace. Edit your `product/package.json` accordingly:

```
  "dependencies": {
-   "design-system": "0.1.0", 
+   "design-system": "0.2.0",
  ...
  }
```



## Building the product
Before you start building a product, you need to make sure that tokens and design-system are built locally, since they are being imported as product dependencies. 
You can build product only with the following command:

```
yarn build:product
```

Or you can use a shortcut to build all 3 workspaces one by one:

```
yarn build
```

## Preparing for deployment

If you want to take advantage of Github Actions and continuosly deploy your product and storybook to github pages, you will need to set a few things:

- Make sure your working repository is public, and the deployment branch is set to "gh-pages". It can be checked and fixed in repository settinds on Github.

- You need to edit "homepage" property in ./product/package.json. It should be pointing to your repository.

```
{
  "homepage": "https://<USERNAME>.github.io/<REPOSITORY_NAME>",
  ...
}
```


## Releasing the product

1. When you are ready to release the product, you need to run the following command to bump the version:

```
yarn version:product
```

2. As soon as you push your commits to main branch, a Github Action(`.github/workflows/release.yml`) will be triggered. It performs two tasks:
- Checks the version of the product and compare it with previous one.
- If version change is detected, build and deploy workflow is activated.

Deploy won't run if the version is the same. If you still need to deploy the previous version for some reason, you can run it manually:

```
yarn deploy
```
